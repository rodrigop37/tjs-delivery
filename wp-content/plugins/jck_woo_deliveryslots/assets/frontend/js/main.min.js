!function(e,t){var s={cache:function(){s.els={},s.vars={},s.els.document=e(t),s.els.document_body=e(t.body),s.els.reservation_table=e(".jckwds-reserve"),s.els.reservation_table_rows=s.els.reservation_table.find("tr"),s.els.reservation_table_prev=e(".jckwds-prevday"),s.els.reservation_table_next=e(".jckwds-nextday"),s.els.date_picker=e("#jckwds-delivery-date"),s.els.timeslot_select=e("#jckwds-delivery-time"),s.els.timeslot_select_wrapper=e("#jckwds-delivery-time-wrapper"),s.els.timeslot_field_row=e("#jckwds-delivery-time_field"),s.els.checkout_fields=e("#jckwds-fields"),s.els.ship_to_different_address_checkbox=e("#ship-to-different-address-checkbox"),s.els.shipping_postcode_field=e("#shipping_postcode"),s.els.billing_postcode_field=e("#billing_postcode"),s.els.multi_step_checkout=e("#wizard"),s.vars.is_checkout=s.els.document_body.hasClass("woocommerce-checkout"),s.vars.has_multi_step=s.els.multi_step_checkout.length>0,s.vars.inactive_class="jckwds-fields-inactive",s.vars.selected_shipping_method=!1,s.vars.default_date=!1},on_load:function(){s.cache(),s.setup_reservation_table(),s.setup_checkout(),s.setup_multi_step_checkout()},setup_reservation_table:function(){s.els.reservation_table.length<=0||(s.setup_prev_next(),s.setup_reserve_button())},setup_checkout:function(){s.vars.is_checkout&&!s.vars.has_multi_step&&(s.setup_checkout_fields(),s.watch_checkout_fields(),s.watch_update_checkout())},setup_multi_step_checkout:function(){s.vars.is_checkout&&s.vars.has_multi_step&&s.els.multi_step_checkout.init(function(){s.cache(),s.setup_checkout_fields(),s.watch_checkout_fields(),s.watch_update_checkout()})},setup_prev_next:function(){s.els.reservation_table_prev.on("click",function(){return e.each(s.els.reservation_table_rows,function(){var t=e(this).find(".colVis:first").index();1!==t&&(e(this).children().eq(t-1).addClass("colVis"),e(this).find(".colVis:last").removeClass("colVis"))}),!1}),s.els.reservation_table_next.on("click",function(){e(".jckwds-reserve thead tr .colVis:last").index(),e(".jckwds-reserve thead tr .colVis:first").index();return e.each(s.els.reservation_table_rows,function(){var t=e(this).find(".colVis:last").index();t+1<e(this).children().length&&(e(this).children().eq(t+1).addClass("colVis"),e(this).find(".colVis:first").removeClass("colVis"))}),!1})},setup_reserve_button:function(){s.els.document.on("click",".jckwds-reserve-slot",function(){return s.activate_slot(e(this)),!1})},activate_slot:function(t){var i=t.parent(),a=i.html(),d=i.attr("data-timeslot-id"),_=i.attr("data-timeslot-date"),o=i.attr("data-timeslot-start-time"),c=i.attr("data-timeslot-end-time"),n=(t.closest(".jckwds-reserve-wrap"),'<div class="jckwds_loading"><i class="jckwds-icn-loading animate-spin"></i></div>'),r={action:"jckwds_remove_reserved_slot",nonce:jckwds_vars.ajax_nonce};t.hide().after(n),jQuery.post(jckwds_vars.ajax_url,r,function(t){if(t.success){s.els.document_body.trigger("reservation_removed");var n={action:"jckwds_reserve_slot",nonce:jckwds_vars.ajax_nonce,slot_id:d,slot_date:_,slot_start_time:o,slot_end_time:c};jQuery.post(jckwds_vars.ajax_url,n,function(t){t.success&&(s.els.document_body.trigger("reservation_added"),e("td.jckwds-reserved").removeClass("jckwds-reserved"),i.addClass("jckwds-reserved").html(a))})}})},setup_checkout_fields:function(){s.setup_date_picker(),s.setup_timeslot_select()},setup_date_picker:function(){var t=jckwds_vars.settings.holidays_holidays_holidays,i=[];e.each(t,function(e,t){i.push(t.date.date)}),s.els.date_picker.datepicker({minDate:"+"+jckwds_vars.settings.datesettings_datesettings_minimum+"D",maxDate:"+"+jckwds_vars.settings.datesettings_datesettings_maximum+"D",beforeShowDay:function(t){var i=e.datepicker.formatDate("dd/mm/yy",t);return-1!==e.inArray(i,jckwds_vars.bookable_dates)?(s.vars.default_date||(s.vars.default_date=t),[!0,"","Available"]):[!1,"","unAvailable"]},dateFormat:jckwds_vars.settings.datesettings_datesettings_dateformat,onSelect:function(t){e(this).trigger("change"),jckwds_vars.settings.timesettings_timesettings_setup_enable&&""!==this.value&&s.update_timeslot_options(this.value)},monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesMin:jckwds_vars.strings.days_short,firstDay:s.get_first_day_of_the_week()}),s.vars.default_date&&s.els.date_picker.datepicker("setDate",s.vars.default_date)},update_timeslot_options:function(t,i){var a=s.els.timeslot_select.find("option:eq(0)"),d=s.els.ship_to_different_address_checkbox.is(":checked")?e("#shipping_postcode").val():e("#billing_postcode").val();s.els.timeslot_select.find("option:gt(0)").remove(),a.text(jckwds_vars.strings.loading),s.els.timeslot_select.trigger("change",["update_timeslots"]);var _={action:"jckwds_slots_on_date",nonce:jckwds_vars.ajax_nonce,date:t,postcode:d};jQuery.post(jckwds_vars.ajax_url,_,function(e){e.success===!0?(a.text(jckwds_vars.strings.selectslot),s.els.timeslot_select.append(e.html),e.reservation&&s.els.timeslot_select.find("option[value='"+e.reservation+"']").length>0&&s.els.timeslot_select.val(e.reservation)):a.text(jckwds_vars.strings.noslots),s.els.document_body.trigger("timeslots_loaded").trigger("update_checkout"),s.els.timeslot_select.trigger("change",["update_timeslots"]),void 0!==i&&i(e)})},refresh_timeslots:function(e){if(e="undefined"!=typeof e?e:!1,s.els.timeslot_field_row.hasClass("jckwds-delivery-time--has-reservation")&&e===!1)return void s.els.timeslot_field_row.removeClass("jckwds-delivery-time--has-reservation");var t=s.els.date_picker.val();""!==t?s.update_timeslot_options(t):s.els.document_body.trigger("timeslots_refreshed").trigger("update_checkout")},watch_checkout_fields:function(){s.els.ship_to_different_address_checkbox.on("change",function(){s.refresh_timeslots(!0)}),s.els.billing_postcode_field.on("change",function(){(!s.els.ship_to_different_address_checkbox.is(":checked")||s.els.shipping_postcode_field.length<=0)&&s.refresh_timeslots(!0)}),s.els.shipping_postcode_field.on("change",function(){s.refresh_timeslots(!0)})},setup_timeslot_select:function(){s.els.timeslot_select.on("change",function(e,t){t="undefined"!=typeof t?t:!1,"update_timeslots"!==t&&s.els.document_body.trigger("update_checkout")})},watch_update_checkout:function(){s.els.document_body.on("updated_checkout",function(){var e=s.get_selected_shipping_method();e!==s.vars.selected_shipping_method&&(s.vars.selected_shipping_method=e,s.toggle_date_time_fields(),s.clear_date_time_fields(),s.refresh_datepicker(function(){s.refresh_timeslots(!0)}))}),s.els.checkout_fields.hasClass(s.vars.inactive_class)&&s.hide_date_time_fields()},refresh_datepicker:function(t){bookable_dates_data={action:"jckwds_get_upcoming_bookable_dates",selected_shipping_method:s.vars.selected_shipping_method},jQuery.post(jckwds_vars.ajax_url,bookable_dates_data,function(i){jckwds_vars.bookable_dates=i.bookable_dates,s.els.date_picker.datepicker("refresh"),jckwds_vars.reserved_slot&&-1!==e.inArray(jckwds_vars.reserved_slot.date.formatted,jckwds_vars.bookable_dates)&&s.els.date_picker.datepicker("setDate",jckwds_vars.reserved_slot.date.formatted),"undefined"!=typeof t&&t(i)})},clear_date_time_fields:function(){e.datepicker._clearDate(s.els.date_picker),s.els.timeslot_select.find("option:first-child").attr("selected","selected")},toggle_date_time_fields:function(){var e=s.check_if_activated_for_shipping_method();e===!1?s.hide_date_time_fields():s.show_date_time_fields()},hide_date_time_fields:function(){var t=e(".jckwds-fields-placeholder");t.length<=0&&s.els.checkout_fields.removeClass(s.vars.inactive_class).hide().after('<div class="jckwds-fields-placeholder"></div>').appendTo("body")},show_date_time_fields:function(){var t=e(".jckwds-fields-placeholder");t.length>0&&t.replaceWith(s.els.checkout_fields.show())},check_if_activated_for_shipping_method:function(){if(s.els.checkout_fields.hasClass(s.vars.inactive_class))return!1;if("any"===jckwds_vars.settings.general_setup_shipping_methods[0])return!0;if("undefined"==typeof jckwds_vars.settings.general_setup_shipping_methods||e.isEmptyObject(jckwds_vars.settings.general_setup_shipping_methods)||e(".shipping_method").length<=0)return!1;var t=e(".shipping_method").length>1?e(".shipping_method:checked","form.checkout").val():e(".shipping_method","form.checkout").val(),i=!1,a=t.replace("wc_shipping_","");return e.each(jckwds_vars.settings.general_setup_shipping_methods,function(e,t){t=t.replace("wc_shipping_",""),(a===t||a.match("^"+t))&&(i=!0)}),i},get_last_day_of_the_week:function(){var e={monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6,sunday:0};return"undefined"==typeof jckwds_vars.settings.datesettings_datesettings_last_day_of_week||"undefined"==typeof e[jckwds_vars.settings.datesettings_datesettings_last_day_of_week]?6:e[jckwds_vars.settings.datesettings_datesettings_last_day_of_week]},get_first_day_of_the_week:function(){var e=s.get_last_day_of_the_week();return 6===e?0:e+1},get_selected_shipping_method:function(){var t={};return e('select.shipping_method, input[name^="shipping_method"][type="radio"]:checked, input[name^="shipping_method"][type="hidden"]').each(function(){t[e(this).data("index")]=e(this).val()}),"undefined"!=typeof t[0]?t[0]:!1}};e(window).load(s.on_load)}(jQuery,document);